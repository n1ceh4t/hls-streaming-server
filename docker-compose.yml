version: '3.8'

services:
  hls-server:
    build: .
    container_name: hls-iptv-server
    ports:
      - "8080:8080"
      - "8081:8081"
    volumes:
      # Mount your media directories here
      # Replace with your actual media paths on the host system
      # Format: /host/path:/container/path:ro
      # Example for multiple directories:
      # - /media/movies:/media/movies:ro
      # - /media/shows:/media/shows:ro
      # - /home/user/Videos:/media/videos:ro
      - /path/to/your/media:/media:ro
      # HLS output (persisted)
      - ./hls_output:/app/hls_output
      # Temp directory
      - ./temp:/app/temp
    environment:
      # Server
      NODE_ENV: production
      PORT: 8080
      HOST: 0.0.0.0

      # Media
      MEDIA_DIRECTORIES: /media
      HLS_OUTPUT_DIR: /app/hls_output
      TEMP_DIR: /app/temp

      # Security - CHANGE THIS!
      API_KEY: ${API_KEY:-change-this-to-a-secure-random-string}
      REQUIRE_AUTH: "true"

      # Streaming
      DEFAULT_VIDEO_BITRATE: 1500000
      DEFAULT_AUDIO_BITRATE: 128000
      DEFAULT_RESOLUTION: 1920x1080
      DEFAULT_FPS: 30
      DEFAULT_SEGMENT_DURATION: 6
      MAX_CONCURRENT_STREAMS: 8

      # Features
      ENABLE_EPG: "true"
      ENABLE_ANALYTICS: "true"
      ENABLE_AUTO_SCAN: "true"
      AUTO_SCAN_INTERVAL: 60

      # Logging
      LOG_LEVEL: info
      LOG_FORMAT: json

      # FFmpeg
      FFMPEG_PATH: /usr/bin/ffmpeg
      FFPROBE_PATH: /usr/bin/ffprobe
      HW_ACCEL: none
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
